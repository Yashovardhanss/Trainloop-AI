<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive MAE vs. MSE Visualization</title>
    <style>
        :root {
            --primary-blue: #0d47a1;
            --light-blue: #e3f2fd;
            --grid-blue: #bbdefb;
            --error-red: #d32f2f;
        }
        body {
            margin: 0;
            background-color: var(--light-blue);
            background-image: radial-gradient(var(--grid-blue) 1px, transparent 1px);
            background-size: 15px 15px;
            font-family: 'Courier New', Courier, monospace;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            padding: 20px 0;
        }
        .container {
            background: rgba(227, 242, 253, 0.9);
            border: 2px solid var(--primary-blue);
            padding: 30px;
            max-width: 1100px;
            width: 95%;
        }
        .title {
            text-align: center;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary-blue);
        }
        .subtitle {
            text-align: center;
            color: var(--primary-blue);
            opacity: 0.8;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--grid-blue);
            padding: 20px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .control-label {
            font-weight: 600;
            font-size: 14px;
        }
        .slider {
            width: 100%;
            height: 4px;
            background: var(--grid-blue);
            outline: none;
            -webkit-appearance: none;
        }
        .slider::-webkit-slider-thumb {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            border: none;
        }
        .value-display {
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            padding: 10px;
            border: 1px solid var(--grid-blue);
        }
        .loss-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .loss-card {
            padding: 15px;
            border: 1px solid var(--primary-blue);
            text-align: center;
            font-weight: 600;
        }
        .loss-card .formula {
            font-size: 12px;
            opacity: 0.7;
        }
        .loss-card .value {
            font-size: 24px;
            margin-top: 5px;
        }
        .charts-grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            border: 1px solid var(--grid-blue);
            padding: 10px;
        }
        .chart-wrapper {
            border: 1px solid var(--grid-blue);
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .chart-wrapper h3 {
            margin: 0 0 10px 0;
            color: var(--primary-blue);
            font-size: 16px;
        }
        .chart-wrapper canvas, .chart-wrapper svg {
            width: 100%;
            display: block;
        }
        .scenario-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .scenario-btn {
            padding: 8px 12px;
            border: 2px solid var(--primary-blue);
            background: transparent;
            color: var(--primary-blue);
            font-weight: bold;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }
        .scenario-btn:hover {
            background: var(--primary-blue);
            color: var(--light-blue);
        }
        .interpretation {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid var(--grid-blue);
        }
        .interpretation h3 {
            margin-top: 0;
            color: var(--primary-blue);
        }
        @media (max-width: 900px) {
            .charts-grid-container {
                grid-template-columns: 1fr;
            }
            .loss-display {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Comparing MAE vs. MSE</h1>
        <p class="subtitle">MAE = &Sigma;|y - &#375;| &nbsp; | &nbsp; MSE = &Sigma;(y - &#375;)&sup2;</p>

        <div class="controls">
            <div class="control-group">
                <label class="control-label">True Value (y)</label>
                <input type="range" id="trueValueSlider" class="slider" min="0" max="100" step="1" value="75">
                <div class="value-display" id="trueValueDisplay">75</div>
            </div>
            <div class="control-group">
                <label class="control-label">Predicted Value (&#375;)</label>
                <input type="range" id="predictedValueSlider" class="slider" min="0" max="100" step="1" value="50">
                <div class="value-display" id="predictedValueDisplay">50</div>
            </div>
        </div>
        
        <div class="loss-display">
            <div class="loss-card">
                <div>Error</div>
                <div class="value" id="errorValue">25</div>
                <div class="formula">(y - &#375;)</div>
            </div>
            <div class="loss-card">
                <div>Absolute Error</div>
                <div class="value" id="absoluteErrorValue">25</div>
                <div class="formula">|y - &#375;|</div>
            </div>
            <div class="loss-card">
                <div>Squared Error</div>
                <div class="value" id="squaredErrorValue">625</div>
                <div class="formula">(y - &#375;)&sup2;</div>
            </div>
        </div>
        
        <div class="charts-grid-container">
            <div class="chart-wrapper">
                <h3>Mean Absolute Error (MAE)</h3>
                <canvas id="mae-canvas" height="150"></canvas>
            </div>
            <div class="chart-wrapper">
                <h3>Mean Squared Error (MSE)</h3>
                <svg width="500" height="300" viewBox="0 0 800 300" id="mse-chart">
                    <!-- Number Line -->
                    <line x1="50" y1="250" x2="750" y2="250" stroke="var(--primary-blue)" stroke-width="2" />
                    <g font-family="inherit" font-size="12" fill="var(--primary-blue)" opacity="0.8" text-anchor="middle">
                        <g><line x1="50" y1="245" x2="50" y2="255" stroke="var(--primary-blue)" stroke-width="2" /><text x="50" y="275">0</text></g>
                        <g><line x1="225" y1="245" x2="225" y2="255" stroke="var(--primary-blue)" stroke-width="2" /><text x="225" y="275">25</text></g>
                        <g><line x1="400" y1="245" x2="400" y2="255" stroke="var(--primary-blue)" stroke-width="2" /><text x="400" y="275">50</text></g>
                        <g><line x1="575" y1="245" x2="575" y2="255" stroke="var(--primary-blue)" stroke-width="2" /><text x="575" y="275">75</text></g>
                        <g><line x1="750" y1="245" x2="750" y2="255" stroke="var(--primary-blue)" stroke-width="2" /><text x="750" y="275">100</text></g>
                    </g>
                    <!-- Error visualization -->
                    <g id="error-group">
                        <rect id="squaredErrorBox" x="0" y="0" width="0" height="0" fill="rgba(211, 47, 47, 0.2)" stroke="var(--error-red)" stroke-width="2" />
                        <line id="errorLineSVG" y1="230" y2="230" stroke="var(--error-red)" stroke-width="2" />
                        <text id="errorLineLabelSVG" y="220" font-family="inherit" font-size="14" fill="var(--error-red)" text-anchor="middle"></text>
                    </g>
                    <!-- Points -->
                    <g>
                        <circle id="trueValuePointSVG" cy="250" r="7" fill="var(--primary-blue)" style="cursor: pointer;"></circle>
                        <text id="trueValueLabelSVG" y="295" font-family="inherit" font-size="14" fill="var(--primary-blue)" text-anchor="middle">y</text>
                    </g>
                    <g>
                        <circle id="predictedValuePointSVG" cy="250" r="7" fill="var(--error-red)" style="cursor: pointer;"></circle>
                        <text id="predictedValueLabelSVG" y="295" font-family="inherit" font-size="14" fill="var(--error-red)" text-anchor="middle">&#375;</text>
                    </g>
                </svg>
            </div>
        </div>
        
        <div class="scenario-buttons">
            <button class="scenario-btn" onclick="setScenario(70, 70)">Perfect Prediction</button>
            <button class="scenario-btn" onclick="setScenario(70, 60)">Small Error (10)</button>
            <button class="scenario-btn" onclick="setScenario(70, 45)">Medium Error (25)</button>
            <button class="scenario-btn" onclick="setScenario(70, 20)">Large Error (50)</button>
        </div>
        
        <div class="interpretation">
            <h3>Comparing the Penalties</h3>
            <p id="interpretationText"></p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- UI ELEMENT REFERENCES ---
        const trueSlider = document.getElementById('trueValueSlider');
        const predSlider = document.getElementById('predictedValueSlider');
        const trueDisplay = document.getElementById('trueValueDisplay');
        const predDisplay = document.getElementById('predictedValueDisplay');
        const errorDisplay = document.getElementById('errorValue');
        const absoluteErrorDisplay = document.getElementById('absoluteErrorValue');
        const squaredErrorDisplay = document.getElementById('squaredErrorValue');
        const interpretationText = document.getElementById('interpretationText');

        // --- GLOBAL STATE & CONSTANTS ---
        const VALUE_MIN = 0;
        const VALUE_MAX = 100;
        const colors = {
            primary: new THREE.Color(getComputedStyle(document.body).getPropertyValue('--primary-blue')),
            error: new THREE.Color(getComputedStyle(document.body).getPropertyValue('--error-red')),
        };

        // --- MSE (SVG) REFERENCES ---
        const truePointSVG = document.getElementById('trueValuePointSVG');
        const predPointSVG = document.getElementById('predictedValuePointSVG');
        const trueLabelSVG = document.getElementById('trueValueLabelSVG');
        const predLabelSVG = document.getElementById('predictedValueLabelSVG');
        const errorLineSVG = document.getElementById('errorLineSVG');
        const errorLineLabelSVG = document.getElementById('errorLineLabelSVG');
        const squaredErrorBox = document.getElementById('squaredErrorBox');
        const SVG_MIN_X = 50;
        const SVG_MAX_X = 750;

        // --- MAE (Three.js) REFERENCES ---
        const maeCanvas = document.getElementById('mae-canvas');
        let maeScene, maeCamera, maeRenderer;
        let maeTruePoint, maePredPoint, maeTrueLabel, maePredLabel, maeErrorLine, maeErrorLabel;
        const MAE_SCENE_WIDTH = 10;

        // --- INITIALIZATION ---
        function init() {
            initMaeScene();
            
            // Event Listeners
            trueSlider.addEventListener('input', updateVisualizations);
            predSlider.addEventListener('input', updateVisualizations);
            window.addEventListener('resize', onWindowResize);

            // Initial call
            updateVisualizations();
        }

        // --- CORE UPDATE LOGIC ---
        function updateVisualizations() {
            const y = parseInt(trueSlider.value);
            const y_hat = parseInt(predSlider.value);
            
            // Calculate errors
            const error = y - y_hat;
            const absError = Math.abs(error);
            const squaredError = error * error;

            // Update text displays
            trueDisplay.textContent = y;
            predDisplay.textContent = y_hat;
            errorDisplay.textContent = error;
            absoluteErrorDisplay.textContent = absError;
            squaredErrorDisplay.textContent = squaredError;

            // Update individual charts
            updateMseChart(y, y_hat, absError);
            updateMaeChart(y, y_hat, absError);
            
            // Update interpretation
            updateInterpretation(absError, squaredError);
        }
        
        // --- MSE (SVG) CHART LOGIC ---
        function mapValueToSvgX(value) {
            return SVG_MIN_X + (value / (VALUE_MAX - VALUE_MIN)) * (SVG_MAX_X - SVG_MIN_X);
        }

        function updateMseChart(y, y_hat, absError) {
            const x_y = mapValueToSvgX(y);
            const x_y_hat = mapValueToSvgX(y_hat);

            truePointSVG.setAttribute('cx', x_y);
            predPointSVG.setAttribute('cx', x_y_hat);
            trueLabelSVG.setAttribute('x', x_y);
            predLabelSVG.setAttribute('x', x_y_hat);

            const error_start_x = Math.min(x_y, x_y_hat);
            const error_end_x = Math.max(x_y, x_y_hat);
            const error_width = error_end_x - error_start_x;

            if (error_width > 1) {
                errorLineSVG.style.display = 'block';
                errorLineLabelSVG.style.display = 'block';
                squaredErrorBox.style.display = 'block';

                errorLineSVG.setAttribute('x1', error_start_x);
                errorLineSVG.setAttribute('x2', error_end_x);
                errorLineLabelSVG.setAttribute('x', error_start_x + error_width / 2);
                errorLineLabelSVG.textContent = `Error: ${absError}`;

                squaredErrorBox.setAttribute('x', error_start_x);
                squaredErrorBox.setAttribute('y', 230 - error_width);
                squaredErrorBox.setAttribute('width', error_width);
                squaredErrorBox.setAttribute('height', error_width);
            } else {
                errorLineSVG.style.display = 'none';
                errorLineLabelSVG.style.display = 'none';
                squaredErrorBox.style.display = 'none';
            }
        }

        // --- MAE (THREE.JS) CHART LOGIC ---
        function initMaeScene() {
            const container = maeCanvas.parentElement;
            maeScene = new THREE.Scene();
            
            // Camera
            const aspect = container.clientWidth / container.clientHeight;
            const sceneHeight = MAE_SCENE_WIDTH / aspect;
            maeCamera = new THREE.OrthographicCamera(-MAE_SCENE_WIDTH / 2, MAE_SCENE_WIDTH / 2, sceneHeight / 2, -sceneHeight / 2, 1, 1000);
            maeCamera.position.z = 10;
            
            // Renderer
            maeRenderer = new THREE.WebGLRenderer({ canvas: maeCanvas, antialias: true, alpha: true });
            maeRenderer.setPixelRatio(window.devicePixelRatio);
            maeRenderer.setSize(container.clientWidth, container.clientHeight);

            // Objects
            const lineMaterial = new THREE.LineBasicMaterial({ color: colors.primary, linewidth: 2 });
            maeScene.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(-MAE_SCENE_WIDTH / 2, 0, 0), new THREE.Vector3(MAE_SCENE_WIDTH / 2, 0, 0)]), lineMaterial));
            for (let i = 0; i <= 100; i += 25) {
                const x = mapValueToMaeCoord(i);
                maeScene.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(x, -0.2, 0), new THREE.Vector3(x, 0.2, 0)]), lineMaterial));
                const label = makeTextSprite(i.toString(), { fontsize: 24, fontColor: colors.primary });
                label.position.set(x, -0.8, 0);
                maeScene.add(label);
            }
            
            const pointGeometry = new THREE.CircleGeometry(0.25, 32);
            maeTruePoint = new THREE.Mesh(pointGeometry, new THREE.MeshBasicMaterial({ color: colors.primary }));
            maeScene.add(maeTruePoint);
            maePredPoint = new THREE.Mesh(pointGeometry, new THREE.MeshBasicMaterial({ color: colors.error }));
            maeScene.add(maePredPoint);
            maeTrueLabel = makeTextSprite('y', { fontsize: 32, fontColor: colors.primary });
            maeScene.add(maeTrueLabel);
            maePredLabel = makeTextSprite('ŷ', { fontsize: 32, fontColor: colors.error });
            maeScene.add(maePredLabel);

            const errorMaterial = new THREE.LineBasicMaterial({ color: colors.error, linewidth: 4 });
            maeErrorLine = new THREE.Line(new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0,0,0), new THREE.Vector3(1,0,0)]), errorMaterial);
            maeErrorLine.position.y = 1.0;
            maeScene.add(maeErrorLine);
            maeErrorLabel = makeTextSprite('', { fontsize: 28, fontColor: colors.error });
            maeErrorLabel.position.y = 1.6;
            maeScene.add(maeErrorLabel);
        }

        function mapValueToMaeCoord(value) {
            return (value / (VALUE_MAX - VALUE_MIN) - 0.5) * MAE_SCENE_WIDTH;
        }

        function updateMaeChart(y, y_hat, absError) {
            const x_y = mapValueToMaeCoord(y);
            const x_y_hat = mapValueToMaeCoord(y_hat);

            maeTruePoint.position.x = x_y;
            maePredPoint.position.x = x_y_hat;
            maeTrueLabel.position.set(x_y, -1.8, 0);
            maePredLabel.position.set(x_y_hat, -1.8, 0);

            const error_start_x = Math.min(x_y, x_y_hat);
            const error_width = Math.abs(x_y_hat - x_y);

            maeErrorLine.position.x = error_start_x;
            maeErrorLine.scale.x = error_width;
            maeErrorLine.visible = error_width > 0.01;

            maeErrorLabel.position.x = error_start_x + error_width / 2;
            maeErrorLabel.material.map.dispose(); 
            maeErrorLabel.material.map = createTextTexture(`Error: ${absError}`, { fontsize: 28, fontColor: colors.error });
            maeErrorLabel.visible = error_width > 0.1;
            
            maeRenderer.render(maeScene, maeCamera);
        }

        // --- INTERPRETATION & UTILS ---
        function updateInterpretation(absError, squaredError) {
            let text = '';
            if (absError === 0) {
                text = 'A perfect prediction! Both MAE and MSE are 0. This is the ideal outcome.';
            } else if (absError <= 10) {
                text = `With a small error of ${absError}, the penalties are comparable. MAE is ${absError}, while MSE is ${squaredError}. MSE's penalty is slightly higher, but the difference is minimal.`;
            } else {
                text = `As the error grows to ${absError}, the difference becomes clear. MAE's penalty is ${absError}, a linear increase. However, MSE's penalty is now ${squaredError}, which is much larger. This shows how MSE begins to heavily penalize larger errors.`;
                 if (absError > 30) {
                     text += ` This is why MSE is more sensitive to outliers than MAE.`
                 }
            }
            interpretationText.textContent = text;
        }

        function makeTextSprite(message, parameters) {
            const texture = createTextTexture(message, parameters);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(texture.image.width / 100, texture.image.height / 100, 1);
            return sprite;
        }
        
        function createTextTexture(message, parameters) {
            const fontface = parameters.fontface || 'Courier New';
            const fontsize = parameters.fontsize || 18;
            const fontColor = parameters.fontColor || new THREE.Color('black');
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            context.font = `Bold ${fontsize}px ${fontface}`;
            const metrics = context.measureText(message);
            canvas.width = metrics.width;
            canvas.height = fontsize;
            context.font = `Bold ${fontsize}px ${fontface}`;
            context.fillStyle = fontColor.getStyle();
            context.fillText(message, 0, fontsize * 0.9);
            const texture = new THREE.Texture(canvas);
            texture.needsUpdate = true;
            return texture;
        }

        function onWindowResize() {
            const container = maeCanvas.parentElement;
            if (!container) return;
            const aspect = container.clientWidth / container.clientHeight;
            const sceneHeight = MAE_SCENE_WIDTH / aspect;
            maeCamera.left = -MAE_SCENE_WIDTH / 2;
            maeCamera.right = MAE_SCENE_WIDTH / 2;
            maeCamera.top = sceneHeight / 2;
            maeCamera.bottom = -sceneHeight / 2;
            maeCamera.updateProjectionMatrix();
            maeRenderer.setSize(container.clientWidth, container.clientHeight);
            updateVisualizations(); // Re-render on resize
        }
        
        function setScenario(y, y_hat) {
            trueSlider.value = y;
            predSlider.value = y_hat;
            updateVisualizations();
        }

        // --- START ---
        init();
    </script>
</body>
</html>
